 <link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.1/dist/leaflet.css" integrity="sha512Rksm5RenBEKSKFjgI3a41vrjkw4EVPlJ3+OiI65vTjIdo9brlAacEuKOiQ5OFh7cOI1bkDwLqdLw3Zg0cRJAAQ==" crossorigin=""/>
 <script src="https://unpkg.com/leaflet@1.3.1/dist/leaflet.js" integrity="sha512-/Nsx9X4HebavoBvEBuyp3I7od5tA0UzAxs+j83KgC8PU0kgB4XiK4Lfe4y4cgBtaRJQEIFCW+oC506aPT2L1zw==" crossorigin=""></script>

<%= form_for @post do |f| %>
  <p>
    <%= f.label :title,"タイトル" %>
    <%= f.text_field :title %>
  </p>

  <p>
    <%= f.label :event_date,"イベント日時" %>
    <%= f.datetime_select :event_date, use_month_numbers: true%>
  </p>

 <div id="map"></div>
  <style type="text/css">
    #map {
      height:300px;
      width:300px;
    }
  </style>

  <div class="field">
    <%= f.label :map_lat,"緯度" %><br>
    <%= f.text_field :map_lat, :id => 'map_latitude'%>
  </div>
  <div class="field">
    <%= f.label :map_lon,"経度" %><br>
    <%= f.text_field :map_lon, :id => 'map_longitude'%>
  </div>


  <p>
    <%= f.label :contents,"内容" %>
    <%= f.text_area :contents %>
  </p>


  <%= f.submit %>
<% end %>

  <script>
  var map, newMarker, markerLocation;
$(function(){

    map = L.map('map').setView([35.007091, 135.758367],13);

    L.tileLayer('http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>',
        maxZoom: 18
    }).addTo(map);
    newMarkerGroup = new L.LayerGroup();
   var theMarker = {};

  map.on('click',function(e){
    lat = e.latlng.lat;
    lon = e.latlng.lng;

        if (theMarker != undefined) {
              map.removeLayer(theMarker);
        };

    //Add a marker to show where you clicked.
     theMarker = L.marker([lat,lon]).addTo(map);  
     document.getElementById('map_latitude').value = lat;
     document.getElementById('map_longitude').value = lon;
});
});

  </script>